def GRID_START 4000000
def GRID_END 4076800
def RAND_BREAK 2147483647
#def RAND_BREAK 2000000000
def COLOR_VAL 2000000
def COUNTER 2000001
def TMPVAL 2000002
def COUNTER2 2000003
def CURRENT_CELL_COUNTER 2000004
def NEW_GRID_START 3000000
def NEW_GRID_END 3076800
def ALL_WHITE 4294967295
def BLUE 255
def RED 16711680
def GREEN 65280
def DRAW_X 2000005
def DRAW_Y 2000006
def W 2000007
def H 2000008
def TMPVAL2 2000009
store 2 0 0 0 $DRAW_X
store 2 0 0 00 $DRAW_Y
store 2 0 0 320 $W 
store 2 0 0 240 $H
store 2 0 0 4294967295 $COLOR_VAL
#
# Fill with random bits
#
store 2 0 0 $GRID_START $COUNTER
::RAND_FILL_LOOP
rand 1 0 0 $TMPVAL
compare 2 1 0 $TMPVAL $RAND_BREAK
branch 3 0 0 1 ``DO_NOT_SET 0
copy 2 0 1 $COLOR_VAL $COUNTER
::DO_NOT_SET
add 3 1 0 $COUNTER 1 $COUNTER
compare 2 1 0 $COUNTER $GRID_END
branch 3 0 0 2 ``RAND_FILL_LOOP 0
#
# Game of Life Start
#
::LIFE_ITER_START
store 2 0 0 $GRID_START $COUNTER
store 2 0 0 $NEW_GRID_START $COUNTER2
::CELL_START
store 2 0 0 0 $CURRENT_CELL_COUNTER
# Mid Right
add 3 1 0 $COUNTER 1 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``MID_RIGHT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::MID_RIGHT_END
# Mid Left 
sub 3 1 0 $COUNTER 1 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``MID_LEFT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::MID_LEFT_END
# Mid Top
sub 3 1 0 $COUNTER 320 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``MID_TOP_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::MID_TOP_END
# Mid Bottom
add 3 1 0 $COUNTER 320 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``MID_BOTTOM_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::MID_BOTTOM_END
# Top Left
sub 3 1 0 $COUNTER 321 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``TOP_LEFT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::TOP_LEFT_END
# Top Right
sub 3 1 0 $COUNTER 319 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``TOP_RIGHT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::TOP_RIGHT_END
# Bottom Left
add 3 1 0 $COUNTER 319 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``BOTTOM_LEFT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::BOTTOM_LEFT_END
# Bottom Right
add 3 1 0 $COUNTER 321 $TMPVAL
copy 2 1 0 $TMPVAL $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``BOTTOM_RIGHT_END 0
add 3 1 0 $CURRENT_CELL_COUNTER 1 $CURRENT_CELL_COUNTER
::BOTTOM_RIGHT_END
copy 2 1 0 $COUNTER $TMPVAL
compare 2 1 0 $TMPVAL 1
branch 3 0 0 2 ``CELL_CURRENTLY_DEAD 0
compare 2 1 0 $CURRENT_CELL_COUNTER 2
branch 3 0 0 2 ``CELL_DIES 0
compare 2 1 0 $CURRENT_CELL_COUNTER 3
branch 3 0 0 1 ``CELL_DIES 0
store 2 0 0 $BLUE $TMPVAL
copy 2 0 1 $TMPVAL $COUNTER2
goto 1 0 0 ``CELL_END
::CELL_DIES
store 2 0 0 0 $TMPVAL
copy 2 0 1 $TMPVAL $COUNTER2
goto 1 0 0 ``CELL_END
::CELL_CURRENTLY_DEAD
compare 2 1 0 $CURRENT_CELL_COUNTER 3
branch 3 0 0 3 ``CELL_SPAWN 0
store 2 1 0 0 $TMPVAL
copy 2 0 1 $TMPVAL $COUNTER2
goto 1 0 0 ``CELL_END
::CELL_SPAWN
store 2 0 0 $GREEN $TMPVAL
copy 2 0 1 $TMPVAL $COUNTER2
::CELL_END
add 3 1 0 $COUNTER 1 $COUNTER
add 3 1 0 $COUNTER2 1 $COUNTER2
compare 2 1 0 $COUNTER $GRID_END
branch 3 0 0 2 ``CELL_START 0
memcpy 3 0 0 $NEW_GRID_START $GRID_START 76800
store 2 0 0 $GRID_START $TMPVAL
drawbmap 6 0 0 $DRAW_X $DRAW_Y $W $H $TMPVAL $VRAM_START
dsync 0 0 0
goto 1 0 0 ``LIFE_ITER_START



